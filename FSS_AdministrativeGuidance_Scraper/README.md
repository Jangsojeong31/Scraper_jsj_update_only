# FSS 행정지도 내역 스크래퍼

금융감독원(FSS)의 행정지도 내역을 스크래핑하는 Python 스크립트입니다.

## 개요

이 스크래퍼는 금융감독원 웹사이트의 행정지도 내역 페이지에서 다음 정보를 수집합니다:

### 목록 페이지에서 수집하는 항목
- 관리번호
- 제목
- 소관부서
- 시행일
- 시행여부
- 첨부

### 상세 페이지에서 수집하는 항목
- 문서번호
- 유효기간
- 첨부파일이름
- 첨부파일링크
- 담당부서
- 담당팀
- 담당자
- 자료문의
- 상세본문내용 (줄바꿈 유지)

## 사용 방법

### 1. 필수 패키지 설치

```bash
pip install requests beautifulsoup4 lxml
```

### 2. 스크래퍼 실행

```bash
python fss_scraper.py
```

### 3. 결과 파일

스크래퍼 실행 후 다음 파일이 생성됩니다:
- `fss_results.json`: JSON 형식의 결과 파일
- `fss_results.csv`: CSV 형식의 결과 파일 (Excel에서 열기 가능, 줄바꿈 포함)
- `run.log`: 실행 로그 파일

## 대상 사이트

- URL: https://www.fss.or.kr/fss/job/admnstgudc/list.do?menuNo=200492&pageIndex=1&searchRegn=&searchYear=&searchCecYn=T&searchWrd=
- 총 약 502건의 데이터를 수집합니다.

## 주요 기능

1. **자동 페이지네이션**: 모든 페이지를 자동으로 순회하며 데이터 수집
2. **중복 제거**: 관리번호를 기준으로 중복 항목 제거
3. **에러 처리**: 네트워크 오류 시 재시도 로직 포함
4. **서버 부하 방지**: 요청 간 적절한 대기 시간 설정
5. **줄바꿈 유지**: 상세본문내용의 줄바꿈(`\n`)을 유지하여 원본 형식 보존
6. **다양한 HTML 구조 지원**: 
   - "1. 관련근거" 또는 "- 아 래 -" 패턴으로 시작하는 본문 추출
   - `<!-- 내용` 주석 이후 `<div bd-view>` 내 `<dl>` 태그 구조 지원
   - 테이블, pre/dd 태그 등 다양한 HTML 구조 자동 인식

## 출력 형식

각 항목은 다음 필드를 포함합니다:

```json
{
  "관리번호": "행2025-61001",
  "제목": "전자지급결제대행업자 정산자금 외부관리 가이드라인",
  "소관부서": "전자금융감독국",
  "시행일": "20250910",
  "시행여부": "시행중",
  "첨부": "",
  "문서번호": "지급결제제도팀-259",
  "유효기간": "시행여부",
  "첨부파일이름": "...",
  "첨부파일링크": "...",
  "담당부서": "법무국 보험·소비자보호팀",
  "담당팀": "지급결제제도팀",
  "담당자": "홍영오 선임조사역",
  "자료문의": "02-3145-8796",
  "상세본문내용": "1. 관련근거 : ｢금융규제 운영규정｣ 제8조\n\n2. 우리원은...\n\n- 아 래 -\n\n- [관리번호]...",
  "상세페이지URL": "https://www.fss.or.kr/..."
}
```

**참고**: `상세본문내용` 필드는 줄바꿈(`\n`)을 포함하여 원본 형식을 유지합니다. CSV 파일을 Excel에서 열 때도 줄바꿈이 제대로 표시됩니다.

## 상세본문내용 추출 방식

스크래퍼는 다음과 같은 다양한 방법으로 상세본문내용을 추출합니다:

1. **패턴 매칭**: "1. 관련근거" 또는 "- 아 래 -" 패턴으로 시작하는 본문 자동 감지
2. **HTML 구조 분석**: 
   - `pre`, `dd`, `div` 태그에서 본문 추출
   - `<!-- 내용` 주석 이후 `<div bd-view>` 내 `<dl>` 태그 구조 지원
   - 테이블 구조에서 첨부파일과 담당부서 사이의 내용 추출
3. **줄바꿈 처리**: 
   - `<br>` 태그를 줄바꿈(`\n`)으로 변환
   - `<dt>`, `<dd>` 태그 사이 줄바꿈 추가
   - 블록 요소(`<p>`, `<div>` 등) 사이 줄바꿈 유지

## 주의사항

- 스크래핑 시 서버에 과도한 부하를 주지 않도록 적절한 대기 시간이 설정되어 있습니다.
- 웹사이트 구조가 변경될 경우 스크래퍼 수정이 필요할 수 있습니다.
- 네트워크 연결이 안정적인 환경에서 실행하는 것을 권장합니다.
- CSV 파일의 줄바꿈은 `csv.QUOTE_ALL` 옵션으로 처리되어 Excel에서 정상적으로 표시됩니다.

## 파일 구조

```
FSS_AdministrativeGuidance_Scraper/
├── fss_scraper.py          # 메인 스크래퍼 스크립트
├── fss_results.json        # JSON 형식 결과 파일
├── fss_results.csv         # CSV 형식 결과 파일
├── run.log                 # 실행 로그 파일
└── README.md               # 이 파일
```

