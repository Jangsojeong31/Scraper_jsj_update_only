"""
데이터 추출 유틸리티
텍스트와 파일명에서 제정일, 개정일, 소관부서를 추출하는 함수
"""
import re
from typing import Tuple


def extract_data_from_text(text: str) -> Tuple[str, str, str]:
    """
    텍스트에서 제정일, 개정일, 소관부서 추출
    
    Args:
        text: 추출할 텍스트 (초반 100자)
        
    Returns:
        (제정일, 최근_개정일, 소관부서) 튜플
    """
    if not text:
        return "", "", ""
    
    enactment_date = ""
    revision_date = ""
    department = ""
    
    # 제정일 패턴 (명시적 패턴 우선, 일반 패턴 후순위)
    enactment_patterns = [
        # 명시적 패턴 (제정일: 형식) - 우선순위 높음
        r"제\s*정\s*일\s*[:：]\s*(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})\.?",              # 제정일: 2024.3.29.
        r"제\s*정\s*일\s*[:：]\s*(\d{4})\s*년\s*(\d{1,2})\s*월\s*(\d{1,2})\s*일",     # 제정일: 2024년 3월 29일
        r"제\s*정\s*일\s*[:：]?\s*(\d{4})[.\-년]\s*(\d{1,2})[.\-월]\s*(\d{1,2})[일.]?", # 제정일: 2024.3.29
        r"제\s*정\s*일\s*[:：]?\s*(\d{4})-(\d{1,2})-(\d{1,2})",                        # 제정일: 2024-3-29
        
        # 일반 패턴 (제정: 또는 제정 형식)
        r"제\s*정\s*[:：]\s*(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})\.?",                    # 제정: 2024.3.29. (공백 포함)
        r"제\s*정\s*[:：]\s*(\d{4})\s*년\s*(\d{1,2})\s*월\s*(\d{1,2})\s*일",           # 제정: 2024년 3월 29일
        r"제\s*정\s*(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})\.?",                            # 제정 2024.3.29. (공백 포함)
        r"제\s*정\s*(\d{4})\s*년\s*(\d{1,2})\s*월\s*(\d{1,2})\s*일",                    # 제정 2024년 3월 29일
        r"제\s*정\s*(\d{4})[.\-년]\s*(\d{1,2})[.\-월]\s*(\d{1,2})[일.]?",              # 제정 2024.3.29
        r"제\s*정\s*(\d{4})-(\d{1,2})-(\d{1,2})",                                      # 제정 2024-3-29
        
        # 추가 패턴
        r"제\s*정\s*(\d{4})/(\d{1,2})/(\d{1,2})",                                      # 제정 2024/3/29
        r"제\s*정\s*일\s*(\d{4})/(\d{1,2})/(\d{1,2})",                                 # 제정일 2024/3/29
        r"\(제\s*정\s*(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})\.?\)",                       # (제정 2024.3.29.)
    ]

    # 개정일 패턴 (명시적 패턴 우선, 일반 패턴 후순위)
    revision_patterns = [
        # 최종/최근 개정일 패턴 - 우선순위 최고
        r"최종\s*개\s*정\s*일\s*[:：]?\s*(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})\.?",      # 최종 개정일: 2024.3.29.
        r"최종\s*개\s*정\s*일\s*[:：]?\s*(\d{4})\s*년\s*(\d{1,2})\s*월\s*(\d{1,2})\s*일", # 최종 개정일: 2024년 3월 29일
        r"최종\s*개\s*정\s*일\s*[:：]?\s*(\d{4})[.\-년]\s*(\d{1,2})[.\-월]\s*(\d{1,2})[일.]?", # 최종 개정일: 2024.3.29
        r"최근\s*개\s*정\s*일\s*[:：]?\s*(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})\.?",        # 최근 개정일: 2024.3.29.
        r"최근\s*개\s*정\s*일\s*[:：]?\s*(\d{4})\s*년\s*(\d{1,2})\s*월\s*(\d{1,2})\s*일", # 최근 개정일: 2024년 3월 29일
        r"최근\s*개\s*정\s*일\s*[:：]?\s*(\d{4})[.\-년]\s*(\d{1,2})[.\-월]\s*(\d{1,2})[일.]?", # 최근 개정일: 2024.3.29
        
        # 개정일: 형식
        r"개\s*정\s*일\s*[:：]\s*(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})\.?",               # 개정일: 2024.3.29.
        r"개\s*정\s*일\s*[:：]\s*(\d{4})\s*년\s*(\d{1,2})\s*월\s*(\d{1,2})\s*일",       # 개정일: 2024년 3월 29일
        r"개\s*정\s*일\s*[:：]?\s*(\d{4})[.\-년]\s*(\d{1,2})[.\-월]\s*(\d{1,2})[일.]?",  # 개정일: 2024.3.29
        r"개\s*정\s*일\s*[:：]?\s*(\d{4})-(\d{1,2})-(\d{1,2})",                         # 개정일: 2024-3-29
        
        # 개정(숫자) 형식 - 개정(1), 개정(2) 등 (마지막 것을 찾기 위해 모든 매치 수집)
        r"개\s*정\s*\(\s*\d+\s*\)\s*[:：]\s*(\d{4})\s*\.\s*(\d{1,2})\s*\.\s*(\d{1,2})",  # 개정(1) : 2018. 6. 1
        r"개\s*정\s*\(\s*\d+\s*\)\s*[:：]?\s*(\d{4})\s*\.\s*(\d{1,2})\s*\.\s*(\d{1,2})", # 개정(1) : 2018. 6. 1 (콜론 없음)
        r"개\s*정\s*\(\s*\d+\s*\)\s*[:：]\s*(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})",        # 개정(1) : 2018.6.1
        r"개\s*정\s*\(\s*\d+\s*\)\s*[:：]?\s*(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})",       # 개정(1) : 2018.6.1 (콜론 없음)
        
        # 일반 패턴 (개정: 또는 개정 형식)
        r"개\s*정\s*[:：]\s*(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})\.?",                     # 개정: 2024.3.29. (공백 포함)
        r"개\s*정\s*[:：]\s*(\d{4})\s*년\s*(\d{1,2})\s*월\s*(\d{1,2})\s*일",            # 개정: 2024년 3월 29일
        r"개\s*정\s*(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})\.?",                             # 개정 2024.3.29. (공백 포함)
        r"개\s*정\s*(\d{4})\s*년\s*(\d{1,2})\s*월\s*(\d{1,2})\s*일",                     # 개정 2024년 3월 29일
        r"개\s*정\s*(\d{4})[.\-년]\s*(\d{1,2})[.\-월]\s*(\d{1,2})[일.]?",               # 개정 2024.3.29
        r"개\s*정\s*(\d{4})-(\d{1,2})-(\d{1,2})",                                       # 개정 2024-3-29
        
        # 추가 패턴
        r"개\s*정\s*(\d{4})/(\d{1,2})/(\d{1,2})",                                       # 개정 2024/3/29
        r"개\s*정\s*일\s*(\d{4})/(\d{1,2})/(\d{1,2})",                                  # 개정일 2024/3/29
        r"\(개\s*정\s*(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})\.?\)",                        # (개정 2024.3.29.)
        r"\(최종\s*개\s*정\s*(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})\.?\)",                 # (최종 개정 2024.3.29.)
    ]

    # 소관부서 패턴 (보수적 패턴 - 명확한 형식만 허용)
    department_patterns = [
        # 명시적 패턴 (소관부서: 형식) - 콜론 포함, 부서명은 명확한 단어로 끝나야 함
        r"소\s*관\s*부\s*서\s*[:：]\s*([가-힣]+(?:팀|부|과|실|국|원|처|청|소|본부|센터|단|위원회|협회|연합|기구))(?:\s|$|\.|,|;|제정|개정|최종|최근|\n)",  # 소관부서: XXX팀/부/과 등
        r"소\s*관\s*부\s*서\s*[:：]\s*([가-힣]+(?:\s+[가-힣]+)*(?:팀|부|과|실|국|원|처|청|소|본부|센터|단|위원회|협회|연합|기구))(?:\s|$|\.|,|;|제정|개정|최종|최근|\n)",  # 소관부서: XXX XXX팀 (여러 단어)
        
        # 소관부서 형식 (콜론 없음) - 공백으로 구분
        r"소\s*관\s*부\s*서\s+([가-힣]+(?:팀|부|과|실|국|원|처|청|소|본부|센터|단|위원회|협회|연합|기구))(?:\s|$|\.|,|;|제정|개정|최종|최근|\n)",  # 소관부서 XXX팀/부/과 등
        r"소\s*관\s*부\s*서\s+([가-힣]+(?:\s+[가-힣]+)*(?:팀|부|과|실|국|원|처|청|소|본부|센터|단|위원회|협회|연합|기구))(?:\s|$|\.|,|;|제정|개정|최종|최근|\n)",  # 소관부서 XXX XXX팀 (여러 단어)
        
        # 담당부서 패턴 - 콜론 포함
        r"담\s*당\s*부\s*서\s*[:：]\s*([가-힣]+(?:팀|부|과|실|국|원|처|청|소|본부|센터|단|위원회|협회|연합|기구))(?:\s|$|\.|,|;|제정|개정|최종|최근|\n)",  # 담당부서: XXX팀/부/과 등
        r"담\s*당\s*부\s*서\s*[:：]\s*([가-힣]+(?:\s+[가-힣]+)*(?:팀|부|과|실|국|원|처|청|소|본부|센터|단|위원회|협회|연합|기구))(?:\s|$|\.|,|;|제정|개정|최종|최근|\n)",  # 담당부서: XXX XXX팀 (여러 단어)
        
        # 담당부서 형식 (콜론 없음) - 공백으로 구분
        r"담\s*당\s*부\s*서\s+([가-힣]+(?:팀|부|과|실|국|원|처|청|소|본부|센터|단|위원회|협회|연합|기구))(?:\s|$|\.|,|;|제정|개정|최종|최근|\n)",  # 담당부서 XXX팀/부/과 등
        r"담\s*당\s*부\s*서\s+([가-힣]+(?:\s+[가-힣]+)*(?:팀|부|과|실|국|원|처|청|소|본부|센터|단|위원회|협회|연합|기구))(?:\s|$|\.|,|;|제정|개정|최종|최근|\n)",  # 담당부서 XXX XXX팀 (여러 단어)
        
        # 소관: 형식 (콜론 포함)
        r"소\s*관\s*[:：]\s*([가-힣]+(?:팀|부|과|실|국|원|처|청|소|본부|센터|단|위원회|협회|연합|기구))(?:\s|$|\.|,|;|제정|개정|최종|최근|\n)",  # 소관: XXX팀/부/과 등
        r"소\s*관\s*[:：]\s*([가-힣]+(?:\s+[가-힣]+)*(?:팀|부|과|실|국|원|처|청|소|본부|센터|단|위원회|협회|연합|기구))(?:\s|$|\.|,|;|제정|개정|최종|최근|\n)",  # 소관: XXX XXX팀 (여러 단어)
        
        # 소관 형식 (콜론 없음) - 공백으로 구분
        r"소\s*관\s+([가-힣]+(?:팀|부|과|실|국|원|처|청|소|본부|센터|단|위원회|협회|연합|기구))(?:\s|$|\.|,|;|제정|개정|최종|최근|\n)",  # 소관 XXX팀/부/과 등
        r"소\s*관\s+([가-힣]+(?:\s+[가-힣]+)*(?:팀|부|과|실|국|원|처|청|소|본부|센터|단|위원회|협회|연합|기구))(?:\s|$|\.|,|;|제정|개정|최종|최근|\n)",  # 소관 XXX XXX팀 (여러 단어)
        
        # 담당: 형식 (콜론 포함)
        r"담\s*당\s*[:：]\s*([가-힣]+(?:팀|부|과|실|국|원|처|청|소|본부|센터|단|위원회|협회|연합|기구))(?:\s|$|\.|,|;|제정|개정|최종|최근|\n)",  # 담당: XXX팀/부/과 등
        r"담\s*당\s*[:：]\s*([가-힣]+(?:\s+[가-힣]+)*(?:팀|부|과|실|국|원|처|청|소|본부|센터|단|위원회|협회|연합|기구))(?:\s|$|\.|,|;|제정|개정|최종|최근|\n)",  # 담당: XXX XXX팀 (여러 단어)
        
        # 담당 형식 (콜론 없음) - 공백으로 구분
        r"담\s*당\s+([가-힣]+(?:팀|부|과|실|국|원|처|청|소|본부|센터|단|위원회|협회|연합|기구))(?:\s|$|\.|,|;|제정|개정|최종|최근|\n)",  # 담당 XXX팀/부/과 등
        r"담\s*당\s+([가-힣]+(?:\s+[가-힣]+)*(?:팀|부|과|실|국|원|처|청|소|본부|센터|단|위원회|협회|연합|기구))(?:\s|$|\.|,|;|제정|개정|최종|최근|\n)",  # 담당 XXX XXX팀 (여러 단어)
        
        # 개정일 뒤에 결재 정보와 함께 나오는 패턴 (예: "개정 2024.3.29. 국장결재 국제총괄팀-793")
        r"개\s*정\s*\d{4}\.?\s*\d{1,2}\.?\s*\d{1,2}\.?\s*[가-힣]*결재\s+([가-힣]+팀)\s*-",  # 공백 포함
        r"개\s*정\s*\d{4}\.?\s*\d{1,2}\.?\s*\d{1,2}\.?\s*[가-힣]*결재\s+([가-힣]+팀)-",   # 공백 없음
        r"개\s*정\s*\d{4}\.?\s*\d{1,2}\.?\s*\d{1,2}\.?\s*[가-힣]*결재\s+([가-힣]+부)\s*-", # 부서명 (팀 대신 부)
        r"개\s*정\s*\d{4}\.?\s*\d{1,2}\.?\s*\d{1,2}\.?\s*[가-힣]*결재\s+([가-힣]+부)-",   # 부서명 (팀 대신 부, 공백 없음)
        r"개\s*정\s*\d{4}\.?\s*\d{1,2}\.?\s*\d{1,2}\.?\s*[가-힣]*결재\s+([가-힣]+과)\s*-", # 과명
        r"개\s*정\s*\d{4}\.?\s*\d{1,2}\.?\s*\d{1,2}\.?\s*[가-힣]*결재\s+([가-힣]+과)-",   # 과명 (공백 없음)
        r"개\s*정\s*\d{4}\.?\s*\d{1,2}\.?\s*\d{1,2}\.?\s*[가-힣]*결재\s+([가-힣]+실)\s*-", # 실명
        r"개\s*정\s*\d{4}\.?\s*\d{1,2}\.?\s*\d{1,2}\.?\s*[가-힣]*결재\s+([가-힣]+실)-",   # 실명 (공백 없음)
    ]

    def normalize_date(year: str, month: str, day: str) -> str:
        """날짜를 YYYY.MM.DD 형식으로 정규화"""
        try:
            return f"{year}.{int(month):02d}.{int(day):02d}."
        except Exception:
            return f"{year}.{month}.{day}."
    
    def clean_department(dept: str) -> str:
        """소관부서 텍스트 정리 (공백 제거, 불필요한 문자 제거, 유효성 검증)"""
        if not dept:
            return ""
        # 앞뒤 공백 제거
        dept = dept.strip()
        # 연속된 공백을 하나로
        dept = re.sub(r'\s+', ' ', dept)
        # 전화번호나 기타 숫자 제거 (예: "-793", "02-1234-5678")
        dept = re.sub(r'\s*-\s*\d+.*$', '', dept)
        dept = re.sub(r'\s*\(\d+\)', '', dept)
        dept = dept.strip()
        
        # 유효성 검증: 부서명은 명확한 단어로 끝나야 함
        valid_endings = ['팀', '부', '과', '실', '국', '원', '처', '청', '소', '본부', '센터', '단', '위원회', '협회', '연합', '기구']
        if not any(dept.endswith(ending) for ending in valid_endings):
            # 끝에 유효한 단어가 없으면 빈 문자열 반환
            return ""
        
        # 너무 짧은 경우 제외 (2자 이하)
        if len(dept) <= 2:
            return ""
        
        return dept
    
    # 제정일 추출
    for pattern in enactment_patterns:
        match = re.search(pattern, text)
        if match:
            groups = match.groups()
            if len(groups) >= 3:
                enactment_date = normalize_date(groups[0], groups[1], groups[2])
                break
    
    # 개정일 추출 (모든 매치를 찾아서 마지막 것 사용)
    all_revision_matches = []
    revision_with_numbers = []  # 개정(숫자) 형식의 경우 숫자와 함께 저장
    
    for pattern in revision_patterns:
        matches = list(re.finditer(pattern, text))
        for match in matches:
            groups = match.groups()
            if len(groups) >= 3:
                date_str = normalize_date(groups[0], groups[1], groups[2])
                
                # 개정(숫자) 형식인지 확인
                match_text = match.group(0)
                number_match = re.search(r'개\s*정\s*\(\s*(\d+)\s*\)', match_text)
                if number_match:
                    # 개정(숫자) 형식인 경우 숫자와 함께 저장
                    revision_number = int(number_match.group(1))
                    revision_with_numbers.append((
                        revision_number,
                        match.start(),
                        date_str
                    ))
                else:
                    # 일반 개정일 형식
                    all_revision_matches.append((
                        match.start(),
                        date_str
                    ))
    
    # 개정(숫자) 형식이 있으면 가장 큰 숫자의 날짜 사용
    if revision_with_numbers:
        # 숫자 순서대로 정렬 (내림차순)
        revision_with_numbers.sort(key=lambda x: x[0], reverse=True)
        revision_date = revision_with_numbers[0][2]
    elif all_revision_matches:
        # 일반 개정일 형식만 있는 경우 텍스트에서 가장 뒤에 나온 것 사용
        all_revision_matches.sort(key=lambda x: x[0])
        revision_date = all_revision_matches[-1][1]
    
    # 소관부서 추출 (모든 매치를 찾아서 첫 번째 것 사용)
    all_department_matches = []
    for pattern in department_patterns:
        matches = list(re.finditer(pattern, text))
        for match in matches:
            groups = match.groups()
            if len(groups) >= 1:
                dept = clean_department(groups[0])
                if dept:
                    all_department_matches.append((
                        match.start(),
                        dept
                    ))
    
    if all_department_matches:
        # 첫 번째 소관부서 선택 (텍스트에서 가장 앞에 나온 것)
        all_department_matches.sort(key=lambda x: x[0])
        department = all_department_matches[0][1]
    
    return enactment_date, revision_date, department


def extract_dates_from_filename(filename: str) -> Tuple[str, str]:
    """
    파일명에서 제정일과 개정일 추출
    
    Args:
        filename: 파일명 (예: "고령_금융소비자보호_가이드라인(2024.08.01._개정)")
        
    Returns:
        (제정일, 최근_개정일) 튜플
    """
    if not filename:
        return "", ""
    
    enactment_date = ""
    revision_date = ""
    
    # 파일명 패턴 (괄호 안의 날짜 형식)
    # 예: (2024.08.01._개정), (2018.3.7 개정(1차)), (21.5.18.개정)
    
    def normalize_date(year: str, month: str, day: str) -> str:
        """날짜를 YYYY.MM.DD 형식으로 정규화"""
        try:
            # 2자리 연도를 4자리로 변환 (50 이상이면 1900년대, 미만이면 2000년대)
            if len(year) == 2:
                year_int = int(year)
                if year_int >= 50:
                    year = f"19{year}"
                else:
                    year = f"20{year}"
            return f"{year}.{int(month):02d}.{int(day):02d}."
        except Exception:
            return f"{year}.{month}.{day}."
    
    # 제정일 패턴 (파일명용)
    enactment_filename_patterns = [
        # (YYYY.MM.DD. 제정) 형식
        r"\((\d{4})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*제\s*정",  # (2024.08.01. 제정)
        r"\((\d{4})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*제\s*정\s*일",  # (2024.08.01. 제정일)
        r"\((\d{4})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*제\s*정\s*\)",  # (2024.08.01. 제정)
        # (YY.M.D. 제정) 형식 (2자리 연도)
        r"\((\d{2})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*제\s*정",  # (24.8.1. 제정)
        r"\((\d{2})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*제\s*정\s*일",  # (24.8.1. 제정일)
        r"\((\d{2})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*제\s*정\s*\)",  # (24.8.1. 제정)
        # 제정일: 형식 (콜론 포함)
        r"제\s*정\s*일\s*[:：]\s*(\d{4})\.(\d{1,2})\.(\d{1,2})",  # 제정일: 2024.08.01
        r"제\s*정\s*[:：]\s*(\d{4})\.(\d{1,2})\.(\d{1,2})",  # 제정: 2024.08.01
    ]
    
    # 개정일 패턴 (파일명용) - 우선순위 높은 것부터
    revision_filename_patterns = [
        # (YYYY.MM.DD. 개정) 형식 - 다양한 변형
        r"\((\d{4})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*개\s*정",  # (2024.08.01. 개정)
        r"\((\d{4})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*개\s*정\s*일",  # (2024.08.01. 개정일)
        r"\((\d{4})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*개\s*정\s*\)",  # (2024.08.01. 개정)
        r"\((\d{4})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*개\s*정\s*\([^)]*\)",  # (2024.08.01. 개정(1차))
        r"\((\d{4})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*개\s*정\s*[^)]*\)",  # (2024.08.01. 개정(추가정보))
        
        # (YY.M.D. 개정) 형식 (2자리 연도)
        r"\((\d{2})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*개\s*정",  # (24.8.1. 개정)
        r"\((\d{2})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*개\s*정\s*일",  # (24.8.1. 개정일)
        r"\((\d{2})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*개\s*정\s*\)",  # (24.8.1. 개정)
        r"\((\d{2})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*개\s*정\s*\([^)]*\)",  # (24.8.1. 개정(1차))
        r"\((\d{2})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*개\s*정\s*[^)]*\)",  # (24.8.1. 개정(추가정보))
        
        # 최종/최근 개정일 패턴
        r"\((\d{4})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*최\s*종\s*개\s*정",  # (2024.08.01. 최종개정)
        r"\((\d{4})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*최\s*근\s*개\s*정",  # (2024.08.01. 최근개정)
        r"\((\d{2})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*최\s*종\s*개\s*정",  # (24.8.1. 최종개정)
        r"\((\d{2})\.(\d{1,2})\.(\d{1,2})\.?\s*[_\s]*최\s*근\s*개\s*정",  # (24.8.1. 최근개정)
        
        # 개정일: 형식 (콜론 포함)
        r"개\s*정\s*일\s*[:：]\s*(\d{4})\.(\d{1,2})\.(\d{1,2})",  # 개정일: 2024.08.01
        r"개\s*정\s*[:：]\s*(\d{4})\.(\d{1,2})\.(\d{1,2})",  # 개정: 2024.08.01
        r"최\s*종\s*개\s*정\s*일\s*[:：]\s*(\d{4})\.(\d{1,2})\.(\d{1,2})",  # 최종개정일: 2024.08.01
        r"최\s*근\s*개\s*정\s*일\s*[:：]\s*(\d{4})\.(\d{1,2})\.(\d{1,2})",  # 최근개정일: 2024.08.01
        
        # 하이픈 구분자 형식
        r"\((\d{4})-(\d{1,2})-(\d{1,2})\s*[_\s]*개\s*정",  # (2024-08-01 개정)
        r"\((\d{2})-(\d{1,2})-(\d{1,2})\s*[_\s]*개\s*정",  # (24-8-1 개정)
        
        # 슬래시 구분자 형식
        r"\((\d{4})/(\d{1,2})/(\d{1,2})\s*[_\s]*개\s*정",  # (2024/08/01 개정)
        r"\((\d{2})/(\d{1,2})/(\d{1,2})\s*[_\s]*개\s*정",  # (24/8/1 개정)
    ]
    
    # 제정일 추출
    for pattern in enactment_filename_patterns:
        match = re.search(pattern, filename)
        if match:
            groups = match.groups()
            if len(groups) >= 3:
                enactment_date = normalize_date(groups[0], groups[1], groups[2])
                break
    
    # 개정일 추출 (모든 매치를 찾아서 마지막 것 사용)
    all_revision_matches = []
    for pattern in revision_filename_patterns:
        matches = list(re.finditer(pattern, filename))
        for match in matches:
            groups = match.groups()
            if len(groups) >= 3:
                all_revision_matches.append((
                    match.start(),
                    normalize_date(groups[0], groups[1], groups[2])
                ))
    
    if all_revision_matches:
        # 마지막 개정일 선택 (파일명에서 가장 뒤에 나온 것)
        all_revision_matches.sort(key=lambda x: x[0])
        revision_date = all_revision_matches[-1][1]
    
    return enactment_date, revision_date

